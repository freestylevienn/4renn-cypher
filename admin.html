<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin | 4RENN CYPHER 001</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bungee&display=swap');
        .graffiti { font-family: 'Bungee', cursive; }
    </style>
</head>
<body class="bg-black text-white min-h-screen">

<!-- ---------- NAVIGATION (unchanged) ---------- -->
<nav class="border-b border-orange-500/20 py-4 px-6 sticky top-0 bg-black/90 backdrop-blur-sm z-50">
    <div class="max-w-6xl mx-auto flex justify-between items-center">
        <a href="index.html" class="graffiti text-2xl text-orange-500">4RENN CYPHER 001</a>
        <div class="hidden md:flex space-x-8">
            <a href="index.html" class="hover:text-orange-500 transition">Home</a>
            <a href="signup.html" class="hover:text-orange-500 transition">Sign Up</a>
            <a href="admin.html" class="bg-orange-500 hover:bg-orange-600 text-black px-4 py-2 rounded-full font-bold transition">Admin</a>
        </div>
        <button class="md:hidden"><i data-feather="menu"></i></button>
    </div>
</nav>

<!-- ---------- ADMIN TABLE (unchanged) ---------- -->
<section class="py-12 px-6">
    <div class="max-w-6xl mx-auto">
        <h1 class="graffiti text-3xl md:text-5xl mb-8 text-orange-500">PARTICIPANT REGISTRATIONS</h1>

        <div class="bg-gray-900/50 rounded-xl border border-orange-500/30 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-800">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-medium text-orange-500 uppercase tracking-wider">Stage Name</th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-orange-500 uppercase tracking-wider">Full Name</th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-orange-500 uppercase tracking-wider">Phone</th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-orange-500 uppercase tracking-wider">M-Pesa Code</th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-orange-500 uppercase tracking-wider">Status</th>
                        </tr>
                    </thead>
                    <tbody id="participantsList" class="divide-y divide-gray-800">
                        <!-- rows injected here -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="mt-6 flex justify-between items-center">
            <div class="text-sm text-gray-500">
                Total: <span id="totalCount" class="text-orange-500">0</span> participants
            </div>
            <button id="refreshBtn" class="flex items-center bg-orange-500 hover:bg-orange-600 text-black px-4 py-2 rounded-full font-bold transition">
                <i data-feather="refresh-cw" class="mr-2"></i> Refresh
            </button>
        </div>
    </div>
</section>

<!-- ---------- SUPABASE SCRIPT (NEW) ---------- -->
<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

const SUPABASE_URL = 'https://vbgnonfedqyvmjrsynpq.supabase.co';
const SUPABASE_SERVICE_ROLE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZiZ25vbmZlZHF5dm1qcnN5bnBxIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1ODI2OTk3MiwiZXhwIjoyMDczODQ1OTcyfQ.-qvOd3-blTtwkKYCXM8DivzCmGKzbIyzR7EKixSIkgE';

const supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY);

async function loadParticipants() {
    const { data, error } = await supabase
        .from('signups')
        .select('*')
        .order('created_at', { ascending: false });

    const participantsList = document.getElementById('participantsList');
    const totalCount = data ? data.length : 0;
    document.getElementById('totalCount').textContent = totalCount;

    if (error || totalCount === 0) {
        participantsList.innerHTML = '<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">No participants found</td></tr>';
        if (error) console.error(error);
        return;
    }

    participantsList.innerHTML = '';

    data.forEach(p => {
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-800/50';
        row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap">${p.stage_name || '-'}</td>
            <td class="px-6 py-4 whitespace-nowrap">${p.full_name}</td>
            <td class="px-6 py-4 whitespace-nowrap">${p.phone}</td>
            <td class="px-6 py-4 whitespace-nowrap">${p.mpesa_code || '-'}</td>
            <td class="px-6 py-4 whitespace-nowrap">
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                    ${p.status === 'approved' ? 'bg-green-500/20 text-green-400' : 
                      p.status === 'rejected' ? 'bg-red-500/20 text-red-400' : 
                      'bg-orange-500/20 text-orange-400'}">
                    ${p.status || 'pending'}
                </span>
            </td>
        `;
        participantsList.appendChild(row);
    });
}

document.getElementById('refreshBtn').addEventListener('click', loadParticipants);

document.addEventListener('DOMContentLoaded', () => {
    feather.replace();
    loadParticipants();
});
</script>

</body>
</html>
